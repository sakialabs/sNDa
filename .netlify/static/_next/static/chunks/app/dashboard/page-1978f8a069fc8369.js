(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{63:(e,t,a)=>{"use strict";var r=a(7260);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},116:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var r=a(5155),s=a(2833),n=a(6948),i=a(2115),o=a(9678);function c(){let{user:e}=(0,s.A)(),[t,a]=(0,i.useState)(null),[c,l]=(0,i.useState)(!0),[d,u]=(0,i.useState)(null),h=(null==e?void 0:e.first_name)?"".concat(e.first_name," ").concat(e.last_name||""):null==e?void 0:e.username;return((0,i.useEffect)(()=>{(async()=>{try{var e;l(!0);let t=await (0,o.t)("/api/cases/"),r=await t.json();a(Array.isArray(r)?r:null!=(e=null==r?void 0:r.results)?e:[])}catch(e){u(e instanceof Error?e.message:"Failed to load cases")}finally{l(!1)}})()},[]),e)?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Volunteer Dashboard"}),(0,r.jsxs)("p",{className:"text-muted-foreground",children:["Welcome back, ",h,"!"]})]}),(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[(0,r.jsxs)(n.Zp,{children:[(0,r.jsx)(n.aR,{children:(0,r.jsx)(n.ZB,{children:"Pending Referrals"})}),(0,r.jsx)(n.Wu,{children:(0,r.jsx)("p",{className:"text-2xl font-bold",children:t?t.filter(e=>"NEW"===e.status).length:"—"})})]}),(0,r.jsxs)(n.Zp,{children:[(0,r.jsx)(n.aR,{children:(0,r.jsx)(n.ZB,{children:"Active Cases"})}),(0,r.jsx)(n.Wu,{children:(0,r.jsx)("p",{className:"text-2xl font-bold",children:t?t.filter(e=>"NEW"!==e.status).length:"—"})})]}),(0,r.jsxs)(n.Zp,{children:[(0,r.jsx)(n.aR,{children:(0,r.jsx)(n.ZB,{children:"Total Cases"})}),(0,r.jsx)(n.Wu,{children:(0,r.jsx)("p",{className:"text-2xl font-bold",children:t?t.length:"—"})})]})]}),d&&(0,r.jsx)("div",{className:"text-sm text-red-600",children:d}),c?(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loading latest cases…"}):t&&t.length>0?(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Recent Cases"}),(0,r.jsx)("ul",{className:"space-y-2",children:t.slice(0,5).map(e=>{var t,a;return(0,r.jsxs)("li",{className:"rounded border p-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("a",{href:"/cases/".concat(e.id),className:"font-medium underline-offset-4 hover:underline focus:outline-none focus-visible:ring-2 focus-visible:ring-ring rounded",children:e.title}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:e.status})]}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:[null==(t=e.primary_subject)?void 0:t.first_name," ",null==(a=e.primary_subject)?void 0:a.last_name]})]},e.id)})})]}):(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"No cases yet."})]}):null}},2727:(e,t,a)=>{"use strict";a.d(t,{i:()=>r});let r={BASE_URL:"https://snda-backend.railway.app",ENDPOINTS:{LOGIN:"/api/token/",REFRESH:"/api/token/refresh/"},STORAGE_KEYS:{ACCESS_TOKEN:"snda_access_token",REFRESH_TOKEN:"snda_refresh_token",USER:"snda_user"}}},2833:(e,t,a)=>{"use strict";a.d(t,{A:()=>u,AuthProvider:()=>d});var r=a(5155),s=a(2115),n=a(63),i=a(6600),o=a(2727),c=a(8720);let l=(0,s.createContext)(void 0);function d(e){let{children:t}=e,[a,d]=(0,s.useState)(null),[u,h]=(0,s.useState)(!0),f=(0,n.useRouter)();async function E(e){try{let t=await e.json();if(t&&"object"==typeof t&&"detail"in t)return t.detail||"";return JSON.stringify(t)}catch(t){try{return await e.text()||e.statusText}catch(t){return e.statusText}}}let m=(0,s.useCallback)(()=>{localStorage.removeItem(o.i.STORAGE_KEYS.ACCESS_TOKEN),localStorage.removeItem(o.i.STORAGE_KEYS.REFRESH_TOKEN),localStorage.removeItem(o.i.STORAGE_KEYS.USER),document.cookie="".concat(o.i.STORAGE_KEYS.ACCESS_TOKEN,"=; Max-Age=0; path=/"),document.cookie="".concat(o.i.STORAGE_KEYS.REFRESH_TOKEN,"=; Max-Age=0; path=/"),d(null),f.push("/")},[f]);(0,s.useEffect)(()=>{(async()=>{let e=localStorage.getItem(o.i.STORAGE_KEYS.ACCESS_TOKEN);if(e)try{let t=(0,i.s)(e);if(1e3*t.exp>Date.now()){let t=await fetch("".concat(o.i.BASE_URL,"/api/users/me/"),{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error(await E(t));let a=await t.json();d(a),localStorage.setItem(o.i.STORAGE_KEYS.USER,JSON.stringify(a))}else m()}catch(e){console.error("Auth initialization error:",e),m()}h(!1)})()},[m]);let S=async(e,t)=>{let a=await fetch("".concat(o.i.BASE_URL).concat(o.i.ENDPOINTS.LOGIN),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})});if(!a.ok)throw Error(await E(a)||"Login failed");let r=await a.json();localStorage.setItem(o.i.STORAGE_KEYS.ACCESS_TOKEN,r.access),localStorage.setItem(o.i.STORAGE_KEYS.REFRESH_TOKEN,r.refresh),document.cookie="".concat(o.i.STORAGE_KEYS.ACCESS_TOKEN,"=").concat(r.access,"; Max-Age=3600; path=/"),document.cookie="".concat(o.i.STORAGE_KEYS.REFRESH_TOKEN,"=").concat(r.refresh,"; Max-Age=604800; path=/");let s=await fetch("".concat(o.i.BASE_URL,"/api/users/me/"),{headers:{Authorization:"Bearer ".concat(r.access)}});if(!s.ok)throw Error(await E(s)||"Failed to load user profile");let n=await s.json();d(n),localStorage.setItem(o.i.STORAGE_KEYS.USER,JSON.stringify(n)),f.push("/dashboard"),c.o.success("Logged in successfully")};return(0,r.jsx)(l.Provider,{value:{user:a,isAuthenticated:!!a,login:S,logout:m,loading:u},children:t})}function u(){let e=(0,s.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},4269:(e,t,a)=>{"use strict";a.d(t,{cn:()=>n});var r=a(2821),s=a(5889);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,r.$)(t))}},6600:(e,t,a)=>{"use strict";a.d(t,{s:()=>s});class r extends Error{}function s(e,t){let a;if("string"!=typeof e)throw new r("Invalid token specified: must be a string");t||(t={});let s=+(!0!==t.header),n=e.split(".")[s];if("string"!=typeof n)throw new r(`Invalid token specified: missing part #${s+1}`);try{a=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Error("base64 string is not of the correct length")}try{var a;return a=t,decodeURIComponent(atob(a).replace(/(.)/g,(e,t)=>{let a=t.charCodeAt(0).toString(16).toUpperCase();return a.length<2&&(a="0"+a),"%"+a}))}catch(e){return atob(t)}}(n)}catch(e){throw new r(`Invalid token specified: invalid base64 for part #${s+1} (${e.message})`)}try{return JSON.parse(a)}catch(e){throw new r(`Invalid token specified: invalid json for part #${s+1} (${e.message})`)}}r.prototype.name="InvalidTokenError"},6948:(e,t,a)=>{"use strict";a.d(t,{Wu:()=>c,ZB:()=>o,Zp:()=>n,aR:()=>i});var r=a(5155);a(2115);var s=a(4269);function n(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card",className:(0,s.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function i(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:(0,s.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function o(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:(0,s.cn)("leading-none font-semibold",t),...a})}function c(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:(0,s.cn)("px-6",t),...a})}},9526:(e,t,a)=>{Promise.resolve().then(a.bind(a,116))},9678:(e,t,a)=>{"use strict";a.d(t,{q:()=>i,t:()=>n});var r=a(2727);function s(e){let t=new Headers(e);{let e=localStorage.getItem(r.i.STORAGE_KEYS.ACCESS_TOKEN);e&&t.set("Authorization","Bearer ".concat(e))}return t}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=s(t.headers);a.has("Content-Type")||a.set("Content-Type","application/json");let n=await fetch("".concat(r.i.BASE_URL).concat(e),{...t,headers:a});if(!n.ok){let e=n.statusText;try{let t=await n.json();t&&"object"==typeof t&&"detail"in t&&(e=t.detail||e)}catch(t){try{e=await n.text()}catch(e){}}throw Error(e)}return n}async function i(e,t){let a=s(),n=await fetch("".concat(r.i.BASE_URL).concat(e),{method:"POST",headers:a,body:t});if(!n.ok){let e=n.statusText;try{let t=await n.json();t&&"object"==typeof t&&"detail"in t&&(e=t.detail||e)}catch(e){}throw Error(e)}return n}}},e=>{e.O(0,[909,720,441,493,358],()=>e(e.s=9526)),_N_E=e.O()}]);